<!doctype html>
<html>
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Simo</title>

<style>
body{
  margin:0;
  font-family:system-ui;
  background:#0b1020;
  color:#fff;
}
.wrap{
  max-width:1000px;
  margin:0 auto;
  padding:20px;
}
.chat{
  border:1px solid rgba(255,255,255,.1);
  padding:15px;
  height:350px;
  overflow:auto;
  margin-bottom:10px;
}
.preview{
  border:1px solid rgba(255,255,255,.1);
  height:350px;
  margin-top:20px;
  background:#111;
}
textarea{
  width:100%;
  height:60px;
  background:#111;
  color:#fff;
  border:1px solid rgba(255,255,255,.2);
  padding:10px;
}
button{
  padding:10px 15px;
  margin-top:5px;
  cursor:pointer;
}
.msg-user{color:#6ea8ff;}
.msg-simo{color:#39d98a;}
</style>
</head>

<body>
<div class="wrap">

<h2>Simo</h2>

<div id="chat" class="chat"></div>

<textarea id="input" placeholder="Enter to send • Shift+Enter for new line"></textarea>
<button id="send">Send</button>
<button id="clear">Clear</button>

<div id="preview" class="preview"></div>

</div>

<script>
const chatEl = document.getElementById("chat");
const inputEl = document.getElementById("input");
const sendBtn = document.getElementById("send");
const clearBtn = document.getElementById("clear");
const previewEl = document.getElementById("preview");

let history = [];

function addMessage(text, role){
  const div = document.createElement("div");
  div.className = role === "user" ? "msg-user" : "msg-simo";
  div.innerText = (role === "user" ? "You: " : "Simo: ") + text;
  chatEl.appendChild(div);
  chatEl.scrollTop = chatEl.scrollHeight;
}

async function sendMessage(){
  const message = inputEl.value.trim();
  if(!message) return;

  addMessage(message,"user");
  history.push({role:"user",content:message});
  inputEl.value="";

  try{
    const res = await fetch("/.netlify/functions/simon",{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({message,history})
    });

    const data = await res.json();

    if(!data.ok){
      addMessage("Error: " + (data.error || "unknown"),"assistant");
      return;
    }

    addMessage(data.reply,"assistant");
    history.push({role:"assistant",content:data.reply});

    if (data.preview_html && data.preview_html.trim()) {
  previewEl.innerHTML = data.preview_html;
} else if (data.mode === "bestfriend") {
  // optional: clear preview when we're back to chat mode
  previewEl.innerHTML = "";
}

  }catch(err){
    addMessage("Network error: " + err.message,"assistant");
  }
}

sendBtn.onclick = sendMessage;

inputEl.addEventListener("keydown", e=>{
  if(e.key==="Enter" && !e.shiftKey){
    e.preventDefault();
    sendMessage();
  }
});

clearBtn.onclick = ()=>{
  chatEl.innerHTML="";
  previewEl.innerHTML="";
  history=[];
  addMessage("Reset. I’m here.","assistant");
};

addMessage("Reset. I’m here.","assistant");
</script>

</body>
</html>

